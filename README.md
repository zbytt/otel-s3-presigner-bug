```mvn clean install && java  -javaagent:AGENT_PATH  -Dotel.javaagent.debug=true -Dotel.instrumentation.experimental.span-suppression-strategy=none -Dspring.profiles.active=bug -Dotel.propagators=xray -jar target/otel-s3-signer-sample-0.0.1-SNAPSHOT.jar```

Application exposes two endpoints that should be called in order:
* /fist -> calls s3 head object on file (which fails, expectedly), then calls presign url, returns provided tracing header 
* /second -> just returns provided tracing header

Tomcat thread pool is set up to just one thread, so all subsequent requests are served by it.
2 requests with x-amzn-trace-id supplied: 
```
curl --location --request GET 'localhost:8080/first' \
--header 'X-Amzn-Trace-Id: Root=1-64dca9cc-0401725c470961ea79d47743;Parent=37897f6e0d28d296;Sampled=1'
curl --location --request GET 'localhost:8080/second' \
--header 'X-Amzn-Trace-Id: Root=1-64dca9d0-0e0e3e9917668c000c07cef7;Parent=6d0575c343cf3dc2;Sampled=1'
```
Application run **without any profile** (remove -Dspring.profiles.active property), uses amazon sdk v1 to generate presign url.
Logs : 
```
2023-08-21 09:45:13.369 trace_id=64dca9cc0401725c470961ea79d47743 span_id=d763389f1b3b8b9b trace_flags=01 xrayId=  INFO 6863 --- [nio-8080-exec-1] pl.zt.otels3signersample.SignController  : Exception: software.amazon.awssdk.core.exception.SdkClientException: Unable to execute HTTP request: Connect to test.localhost:5055 [test.localhost/127.0.0.1, test.localhost/0:0:0:0:0:0:0:1] failed: Connection refused
2023-08-21 09:45:13.397 trace_id=64dca9cc0401725c470961ea79d47743 span_id=d763389f1b3b8b9b trace_flags=01 xrayId=  INFO 6863 --- [nio-8080-exec-1] pl.zt.otels3signersample.SignController  : Header received: Root=1-64dca9cc-0401725c470961ea79d47743;Parent=37897f6e0d28d296;Sampled=1
[otel.javaagent 2023-08-21 09:45:13:424 +0200] [http-nio-8080-exec-1] INFO io.opentelemetry.exporter.logging.LoggingSpanExporter - 'SignController.generateUrl' : 64dca9cc0401725c470961ea79d47743 d763389f1b3b8b9b INTERNAL [tracer: io.opentelemetry.spring-webmvc-3.1:1.29.0-alpha] AttributesMap{data={thread.id=29, thread.name=http-nio-8080-exec-1}, capacity=128, totalAddedValues=2}
[otel.javaagent 2023-08-21 09:45:13:425 +0200] [http-nio-8080-exec-1] INFO io.opentelemetry.exporter.logging.LoggingSpanExporter - 'GET /first' : 64dca9cc0401725c470961ea79d47743 87b422fcbbaa0ba6 SERVER [tracer: io.opentelemetry.tomcat-7.0:1.29.0-alpha] AttributesMap{data={thread.id=29, user_agent.original=PostmanRuntime/7.28.4, net.host.name=localhost, net.sock.peer.port=40292, http.target=/first, net.sock.peer.addr=0:0:0:0:0:0:0:1, net.host.port=8080, http.status_code=200, thread.name=http-nio-8080-exec-1, http.route=/first, net.sock.host.addr=0:0:0:0:0:0:0:1, net.protocol.name=http, net.protocol.version=1.1, http.scheme=http, http.method=GET}, capacity=128, totalAddedValues=15}
2023-08-21 09:45:14.783 trace_id=64dca9d00e0e3e9917668c000c07cef7 span_id=6266fb26f595b840 trace_flags=01 xrayId=  INFO 6863 --- [nio-8080-exec-1] pl.zt.otels3signersample.SignController  : Header received: Root=1-64dca9d0-0e0e3e9917668c000c07cef7;Parent=6d0575c343cf3dc2;Sampled=1
[otel.javaagent 2023-08-21 09:45:14:783 +0200] [http-nio-8080-exec-1] INFO io.opentelemetry.exporter.logging.LoggingSpanExporter - 'SignController.any' : 64dca9d00e0e3e9917668c000c07cef7 6266fb26f595b840 INTERNAL [tracer: io.opentelemetry.spring-webmvc-3.1:1.29.0-alpha] AttributesMap{data={thread.id=29, thread.name=http-nio-8080-exec-1}, capacity=128, totalAddedValues=2}
[otel.javaagent 2023-08-21 09:45:14:784 +0200] [http-nio-8080-exec-1] INFO io.opentelemetry.exporter.logging.LoggingSpanExporter - 'GET /second' : 64dca9d00e0e3e9917668c000c07cef7 26388edc2433d54a SERVER [tracer: io.opentelemetry.tomcat-7.0:1.29.0-alpha] AttributesMap{data={thread.id=29, user_agent.original=PostmanRuntime/7.28.4, net.host.name=localhost, net.sock.peer.port=40292, http.target=/second, net.sock.peer.addr=0:0:0:0:0:0:0:1, net.host.port=8080, http.status_code=200, thread.name=http-nio-8080-exec-1, http.route=/second, net.sock.host.addr=0:0:0:0:0:0:0:1, net.protocol.name=http, net.protocol.version=1.1, http.scheme=http, http.method=GET}, capacity=128, totalAddedValues=15}
```

Application run **with the `bug` profile** uses sdk v2 to presign url, this time, serving the same requests yields different logs :
```
2023-08-21 10:01:45.233 trace_id=64dca9cc0401725c470961ea79d47743 span_id=1df92e204df327ac trace_flags=01 xrayId=  INFO 11641 --- [nio-8080-exec-1] pl.zt.otels3signersample.SignController  : Exception: software.amazon.awssdk.core.exception.SdkClientException: Unable to execute HTTP request: Connect to test.localhost:5055 [test.localhost/127.0.0.1, test.localhost/0:0:0:0:0:0:0:1] failed: Connection refused
2023-08-21 10:01:45.273 trace_id=64dca9cc0401725c470961ea79d47743 span_id=be0fb97a1407c035 trace_flags=01 xrayId=  INFO 11641 --- [nio-8080-exec-1] pl.zt.otels3signersample.SignController  : Header received: Root=1-64dca9cc-0401725c470961ea79d47743;Parent=37897f6e0d28d296;Sampled=1
[otel.javaagent 2023-08-21 10:01:45:297 +0200] [http-nio-8080-exec-1] DEBUG io.opentelemetry.javaagent.shaded.io.opentelemetry.context.ThreadLocalContextStorage -  Trying to close scope which does not represent current context. Ignoring the call.
[otel.javaagent 2023-08-21 10:01:45:297 +0200] [http-nio-8080-exec-1] INFO io.opentelemetry.exporter.logging.LoggingSpanExporter - 'SignController.generateUrl' : 64dca9cc0401725c470961ea79d47743 1df92e204df327ac INTERNAL [tracer: io.opentelemetry.spring-webmvc-3.1:1.29.0-alpha] AttributesMap{data={thread.id=29, thread.name=http-nio-8080-exec-1}, capacity=128, totalAddedValues=2}
[otel.javaagent 2023-08-21 10:01:45:298 +0200] [http-nio-8080-exec-1] DEBUG io.opentelemetry.javaagent.shaded.io.opentelemetry.context.ThreadLocalContextStorage -  Trying to close scope which does not represent current context. Ignoring the call.
[otel.javaagent 2023-08-21 10:01:45:298 +0200] [http-nio-8080-exec-1] DEBUG io.opentelemetry.javaagent.shaded.io.opentelemetry.context.ThreadLocalContextStorage -  Trying to close scope which does not represent current context. Ignoring the call.
[otel.javaagent 2023-08-21 10:01:45:299 +0200] [http-nio-8080-exec-1] INFO io.opentelemetry.exporter.logging.LoggingSpanExporter - 'GET /first' : 64dca9cc0401725c470961ea79d47743 cc9e7b9d4a27eef8 SERVER [tracer: io.opentelemetry.tomcat-7.0:1.29.0-alpha] AttributesMap{data={thread.id=29, user_agent.original=PostmanRuntime/7.28.4, net.host.name=localhost, net.sock.peer.port=56416, http.target=/first, net.sock.peer.addr=0:0:0:0:0:0:0:1, net.host.port=8080, http.status_code=200, thread.name=http-nio-8080-exec-1, http.route=/first, net.sock.host.addr=0:0:0:0:0:0:0:1, net.protocol.name=http, net.protocol.version=1.1, http.scheme=http, http.method=GET}, capacity=128, totalAddedValues=15}
[otel.javaagent 2023-08-21 10:01:46:420 +0200] [http-nio-8080-exec-1] WARN io.opentelemetry.javaagent.shaded.instrumentation.api.internal.ContextPropagationDebug - Unexpected non-root current context found when extracting remote context!
[otel.javaagent 2023-08-21 10:01:46:420 +0200] [http-nio-8080-exec-1] WARN io.opentelemetry.javaagent.shaded.instrumentation.api.internal.ContextPropagationDebug - It contains this span: SdkSpan{traceId=64dca9cc0401725c470961ea79d47743, spanId=be0fb97a1407c035, parentSpanContext=ImmutableSpanContext{traceId=64dca9cc0401725c470961ea79d47743, spanId=1df92e204df327ac, traceFlags=01, traceState=ArrayBasedTraceState{entries=[]}, remote=false, valid=true}, name=s3.PutObject, kind=CLIENT, attributes=AttributesMap{data={thread.id=29, rpc.method=PutObject, aws.bucket.name=test, rpc.service=s3, rpc.system=aws-api, thread.name=http-nio-8080-exec-1}, capacity=128, totalAddedValues=6}, status=ImmutableStatusData{statusCode=UNSET, description=}, totalRecordedEvents=0, totalRecordedLinks=0, startEpochNanos=1692604905262934568, endEpochNanos=0}
2023-08-21 10:01:46.422 trace_id=64dca9d00e0e3e9917668c000c07cef7 span_id=f0eed09dffeb3955 trace_flags=01 xrayId=  INFO 11641 --- [nio-8080-exec-1] pl.zt.otels3signersample.SignController  : Header received: Root=1-64dca9d0-0e0e3e9917668c000c07cef7;Parent=6d0575c343cf3dc2;Sampled=1
[otel.javaagent 2023-08-21 10:01:46:423 +0200] [http-nio-8080-exec-1] INFO io.opentelemetry.exporter.logging.LoggingSpanExporter - 'SignController.any' : 64dca9d00e0e3e9917668c000c07cef7 f0eed09dffeb3955 INTERNAL [tracer: io.opentelemetry.spring-webmvc-3.1:1.29.0-alpha] AttributesMap{data={thread.id=29, thread.name=http-nio-8080-exec-1}, capacity=128, totalAddedValues=2}
[otel.javaagent 2023-08-21 10:01:46:424 +0200] [http-nio-8080-exec-1] INFO io.opentelemetry.exporter.logging.LoggingSpanExporter - 'GET' : 64dca9d00e0e3e9917668c000c07cef7 a6a6a9a5f3a2bfa1 SERVER [tracer: io.opentelemetry.tomcat-7.0:1.29.0-alpha] AttributesMap{data={thread.id=29, user_agent.original=PostmanRuntime/7.28.4, net.host.name=localhost, net.sock.peer.port=56416, http.target=/second, net.sock.peer.addr=0:0:0:0:0:0:0:1, net.host.port=8080, http.status_code=200, thread.name=http-nio-8080-exec-1, http.route=/first, net.sock.host.addr=0:0:0:0:0:0:0:1, net.protocol.name=http, net.protocol.version=1.1, http.scheme=http, http.method=GET}, capacity=128, totalAddedValues=15}
[otel.javaagent 2023-08-21 10:01:47:448 +0200] [OkHttp http://localhost:4317/...] WARN io.opentelemetry.exporter.internal.grpc.GrpcExporter - Failed to export spans. Server responded with gRPC status code 2. Error message: Failed to connect to localhost/127.0.0.1:4317

```